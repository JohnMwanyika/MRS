extends layout
block content
    if (status == "success")
        //- alert
        .alert.alert-success.alert-dismissible.fade.show(role='alert')
            i.bi.bi-envelope
            | Mail found
            button.btn-close(type='button' data-bs-dismiss='alert' aria-label='Close')
        //- .alert.bg-success.text-white Mail found
        form(action="/mails/reset" method="post")
            if (data.Department.name)
                .form-floating.mb-3
                    input(type="text" class="form-control" id="depertment" value=`${data.Department.name}` name="department" placeholder="Last Name", required, disabled)
                    input(type="text" class="form-control" id="depertment" value=`${data.Department.name}` name="department" placeholder="Last Name", required)
                    label(for="depertment") Department
            .form-floating.mb-3
                input(type="text" class="form-control" id="lastName" value=`${data.name}` name="fullName" placeholder="Last Name", required disabled)
                input(type="hidden" class="form-control" id="lastName" value=`${data.name}` name="fullName" placeholder="Last Name", required)
                label(for="fullName") Full Name
            .form-floating.mb-3
                input(type="email" class="form-control" id="email" value=`${data.email}` name="email" placeholder="Email", required disabled)
                input(type="hidden" class="form-control" id="email" value=`${data.email}` name="email" placeholder="Email", required)
                label(for="email") Email
            button(type="submit" class="btn btn-danger w-100 mt-3")
                i.fa.fa-paper-plane.me-2
                | Reset Password
    else
        //- form(action="/mails/request" method="post")
            input(type="text" class="form-control" id="firstName" value=`${current.firstName}` name="firstName" placeholder="First Name", required)
            input(type="text" class="form-control" id="lastName" value=`${current.lastName}` name="lastName" placeholder="Last Name", required)
            .alert.bg-warning #{data} try again <button type='submit' class="btn btn-danger btn-sm" href="/mails/request" role="button">Request</button>
        form(action="/mails/request" method="post")#myform
            .alert.alert-dismissible.fade.show(role='alert',class=`alert-${status}`)#msg
                i.bi.bi-envelope
                | #{data} 
                button.btn-close(type='button' data-bs-dismiss='alert' aria-label='Close')
            //- try again <button type='submit' class="btn btn-danger btn-sm" role="button">Request</button>
            .form-floating.mb-3.mt-3
                input(type="text" class="form-control" id="firstName" value=`${current.firstName}` name="firstName" placeholder="First Name", )
                label(for="firstName") First Name
            .form-floating.mb-3
                input(type="text" class="form-control" id="lastName" value=`${current.lastName}` name="lastName" placeholder="Last Name", )
                label(for="lastName") Last Name
            .row 
                .col-6
                    a( class="btn btn-primary w-100 mt-3" href='/')#submitbtn
                        i.fa.fa-paper-plane.me-2
                        | Try again 
                        //- span.spinner-border.spinner-border-sm(role="status" aria-hidden="true")#spina
                .col-6
                    button( class="btn btn-danger w-100 mt-3")
                        i.fa.fa-paper-plane.me-2
                        | Send request

    script(src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js")
    //- script.
        var loading = $('#spina').hide();
        $("#submitbtn").click(function(event){
            event.preventDefault();
            var form = $("#myform");
            var msg = $("#msg");

            function validateForm() {
                var isValid = true;
                $('.form-control').each(function() {
                    if ( $(this).val() === '' )
                        isValid = false;
                });
                return isValid;
            }

            //- prevent submission of empty fields
            //- if(!($("#firstName").val() && $("#lasttName").val())){
            let res = validateForm();
            if(!res){
                msg.text('Please fill all fields')
            }else{

                $.ajax({
                    url:'/mails/api/user',
                    type:'post',
                    data: form.serialize(),
                    beforeSend: function(){
                        loading.show(function(){
                            $("#submitbtn").prop("disabled", true);
                        });
                    },
                    complete: function(){
                        loading.hide(function(){
                            $("#submitbtn").removeAttr('disabled');
                        });
                        //- listenToCallback();
                    },
                    success: function(data){
                        let rescode = data;
                        //- alert(rescode)
                        msg.text(data.data);
                        msg.prop("alert-success", true);
                        //- msg.removeAttr('alert-warning',function(){
                        //-     msg.prop("alert-success", true);
                        //- })
                        console.log(data)
                    },
                    timeout: 10000,
                    error: function (request, status, error) {
                        alert(request,status);
                        
                    }

                });
            }
        });